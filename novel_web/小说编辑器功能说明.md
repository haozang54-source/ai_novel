# AI小说编辑器 - 功能说明

## 概述

已将原来的"大纲编辑器"升级为完整的"小说编辑器",提供全方位的创作辅助功能。

## 功能模块

### 一、创作内容区

#### 1. 大纲与章节
- **卷级大纲**: 统领全书的宏观结构
- **章节大纲**: 逐章详细规划
- **编辑功能**: 支持修改标题、摘要、定位、冲突、情感基调等

### 二、创作设定区

#### 2. 文风设定
- **快速配置**: 
  - 叙述视角 (第一人称/第三人称全知/第三人称限知)
  - 语言风格 (现代口语化/古典文雅/网文爽文/诗意抒情)
  - 对话风格 (简洁/生动/幽默/正式)
  - 描写密度 (简练/适中/细腻)
- **文风样本库**: 可添加不同场景类型的样本段落供AI参考
- **AI权重**: 可调整AI参考该设定的权重 (0.5-2.0)

#### 3. 世界观设定
- **树形结构**: 支持多层级组织
- **分类管理**: 时代背景/地理环境/社会结构/力量体系/规则设定
- **重要程度**: 1-5星标记
- **标签系统**: 自定义标签便于检索

#### 4. 人物管理
- **基本档案**: 姓名、别名、性别、年龄、外貌、性格、背景
- **能力与目标**: 角色能力、人物目标、内在冲突
- **成长轨迹**: 人物弧光、关键时刻记录
- **角色分类**: 主角/配角/反派/路人
- **状态追踪**: 存活状态、当前位置
- **重要程度**: 1-5星评级
- **人物关系**: (待开发) 关系图谱可视化

#### 5. 地点/地图
- **层级式地理**: 大陆→国家→城市→建筑→房间
- **详细信息**: 气候、地形、特殊地貌
- **地图功能**: (待完善) 上传地图图片、标注坐标
- **出场追踪**: 首次出现、所有出现章节

#### 6. 物品/道具
- **分类归档**: 武器/法宝/丹药/功法/宝物/消耗品
- **详细属性**: 外观、功能、来历、品阶、稀有度
- **持有者追踪**: 当前持有者、持有历史
- **状态管理**: 正常/损坏/遗失/摧毁

### 三、创作辅助区

#### 7. 伏笔管理 (看板视图)
- **三列布局**:
  - 已埋下: 尚未揭晓的伏笔
  - 已呼应: 已经揭示的伏笔
  - 已放弃: 决定不用的伏笔
  
- **伏笔信息**:
  - 埋设章节、内容、方式 (明示/暗示/道具/对话)
  - 计划揭晓章节、实际揭晓章节
  - 关联要素 (人物/物品/地点)
  - 重要程度 (1-5星)
  - 紧迫度 (1-5级,影响AI提醒)
  
- **快捷操作**: 一键标记为"已揭示"

## 路由变更

- **旧路由**: `/projects/:id/outline`
- **新路由**: `/projects/:id` (保持向后兼容,自动重定向)

## 数据模型

### 后端新增表

1. `writing_styles` - 文风设定
2. `worldviews` - 世界观 (支持树形结构)
3. `characters` - 人物角色
4. `character_relations` - 人物关系
5. `locations` - 地点/地图 (支持树形结构)
6. `items` - 物品/道具
7. `foreshadowings` - 伏笔管理

### API接口

所有模块均提供完整的CRUD接口:
- `GET /api/{module}/project/{project_id}` - 获取项目的所有数据
- `GET /api/{module}/{id}` - 获取单条数据
- `POST /api/{module}` - 创建
- `PUT /api/{module}/{id}` - 更新
- `DELETE /api/{module}/{id}` - 删除

特殊接口:
- `POST /api/foreshadowings/{id}/reveal` - 标记伏笔为已揭示
- `GET /api/characters/{id}/relations` - 获取人物关系
- `POST /api/characters/relations` - 创建人物关系

## 启动方式

### 方式一: 使用启动脚本 (推荐)
```bash
cd novel_web
./start.sh
```

### 方式二: 手动启动

1. 启动后端:
```bash
cd novel_web/backend
python3 migrate.py  # 首次运行,创建数据库表
python3 app.py
```

2. 启动前端:
```bash
cd novel_web/frontend
npm run dev
```

## 使用说明

1. **创建项目**: 在首页点击"新建项目"
2. **进入编辑器**: 点击项目卡片进入小说编辑器
3. **切换模块**: 左侧导航栏选择不同功能模块
4. **添加数据**: 每个模块右上角有"添加"按钮
5. **编辑/删除**: 列表项右侧有操作按钮

## AI集成 (下一步)

所有创作设定都设计了AI权重字段,未来将实现:

1. **生成章节时动态组装上下文**:
   - 文风设定 → 控制AI写作风格
   - 相关人物 → 保持人设一致性
   - 当前地点 → 环境描写准确
   - 相关物品 → 道具使用合理
   - 未解伏笔 → AI主动提示填坑时机

2. **AI辅助功能**:
   - 根据人物档案生成对话
   - 根据地点信息生成场景描写
   - 检测伏笔遗漏并提醒
   - 分析人物关系冲突

## 待完善功能

- [ ] 人物关系图谱可视化 (使用React Flow或G6)
- [ ] 地图标注功能
- [ ] 时间线管理
- [ ] 冲突矩阵
- [ ] 统计分析 (字数、热力图、出场频率)
- [ ] 版本历史与回退
- [ ] AI深度集成

## 技术栈

**前端**:
- React 18 + TypeScript
- Ant Design 5
- Zustand (状态管理)
- React Router

**后端**:
- Python 3.x
- Flask
- SQLAlchemy
- SQLite (可切换为PostgreSQL/MySQL)

## 数据库迁移

如果已有旧数据库,运行迁移脚本会自动创建新表,不影响现有数据:

```bash
cd novel_web/backend
python3 migrate.py
```
