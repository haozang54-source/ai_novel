# AI编辑助手功能说明

## 功能概述

AI编辑助手是小说编辑器的核心功能，允许作者选中章节中的任意文字，与AI进行对话交互，获得智能改写建议。

## 主要特性

### 1. 文本选择与交互
- **选中文字**: 在章节编辑器中选中任意段落或句子
- **实时反馈**: 显示已选中的字符数
- **上下文感知**: 自动提取选中文本的前后200字作为上下文

### 2. 知识库集成
可选择以下知识库来辅助AI理解故事背景：

- **人物档案**: 选择相关角色，AI会参考其性格、能力、成长轨迹
- **世界观设定**: 选择世界观元素，确保改写符合设定
- **地点信息**: 选择场景地点，增强环境描写准确性
- **物品/道具**: 选择涉及的物品，保持道具描述一致性
- **伏笔管理**: 选择相关伏笔，帮助AI理解隐含线索
- **文风设定**: 应用项目文风配置，保持整体风格统一

### 3. 对话式修改
- **自定义指令**: 用自然语言描述修改需求，例如：
  - "增加更多细节描写"
  - "改为第一人称视角"
  - "加入悬疑氛围"
  - "补充人物心理活动"
- **多轮对话**: 支持继续对话，逐步优化改写结果
- **历史记录**: 显示完整的对话历史

### 4. 预览与编辑
- **AI建议**: 显示AI的改写理由和置信度
- **可编辑预览**: 对AI生成的文本进行手动调整
- **三种操作**:
  - **应用修改**: 将改写后的文本替换原文
  - **取消**: 放弃本次修改
  - **继续对话**: 基于当前结果继续优化

## 使用流程

```
1. 在章节编辑器中选中要修改的文字
   ↓
2. 点击"AI助手"按钮打开侧边面板
   ↓
3. （可选）选择相关知识库
   ↓
4. 输入修改指令，点击"AI分析"
   ↓
5. 查看AI建议和改写结果
   ↓
6. 在预览框中编辑调整
   ↓
7. 选择"应用修改"或"继续对话"
```

## 技术架构

### 前端组件
- **ChapterWritingTab**: 章节编辑页面
- **AIAssistantPanel**: AI助手侧边抽屉

### 后端API
- `POST /api/ai-assistant/analyze`: 分析文本并生成改写建议
- `GET /api/ai-assistant/knowledge-base/:projectId`: 获取项目知识库

### 数据流
```
选中文本 → 用户指令 + 知识库 → AI分析 → 生成建议 → 用户编辑 → 应用到正文
```

## 扩展计划

### 待集成AI服务
当前使用模拟数据，后续可集成：
- **tRPC服务**: 调用内部AI模型
- **OpenAI API**: 使用GPT-4等模型
- **Claude API**: 使用Anthropic的模型
- **自定义微调模型**: 针对特定文风训练

### 高级功能
- **批量改写**: 一次性优化多个段落
- **风格迁移**: 将一种文风转换为另一种
- **情感调节**: 调整文本的情感基调
- **字数控制**: 扩写或缩写到指定长度
- **多版本对比**: 生成多个改写版本供选择

## 注意事项

1. **选中文本限制**: 建议选中200-1000字，过长或过短可能影响效果
2. **知识库选择**: 选择过多知识库可能导致AI分析时间过长
3. **网络延迟**: AI分析需要网络请求，请耐心等待
4. **保存提醒**: 应用修改后记得保存章节内容

## 示例场景

### 场景1: 增强细节描写
**原文**: 
```
张三走进了房间。
```

**指令**: "增加环境和心理描写"

**AI改写**:
```
张三推开厚重的木门，一股霉味扑面而来。他皱了皱眉，打量着这间已经空置多年的老房子——墙角的蜘蛛网、落满灰尘的桌椅，都在诉说着岁月的流逝。
```

### 场景2: 视角转换
**原文** (第三人称):
```
李四看到了那把剑，心中涌起一股莫名的熟悉感。
```

**指令**: "改为第一人称内心独白"

**AI改写**:
```
我的目光被墙上那把剑吸引住了。奇怪……这股熟悉感是从何而来？仿佛在很久以前，我曾握过这把剑。
```

### 场景3: 融入伏笔
**选中伏笔**: "主角的真实身份"

**指令**: "暗示主角身份的特殊性"

**AI改写**:
```
他下意识地摸了摸左肩的胎记——那个奇异的七芒星图案。每当触碰它时，脑海中总会闪过一些支离破碎的画面，像是属于另一个人的记忆。
```
